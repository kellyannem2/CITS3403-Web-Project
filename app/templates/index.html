<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FitTrack Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>


  {% include 'header.html' %}

  <main>
    <div class="columns">

      <!-- Leaderboard Column -->
      <div class="column">
        <div class="column-header">
            <h2 onclick="location.href='{{ url_for('leaderboard') }}'" style="cursor:pointer;">Leaderboard</h2>
        </div>
        <p class="subheading">Today's scoreboard</p>
        <div id="scoreboard-section"></div>
    
        <button onclick="refreshScoreboard()">Refresh Scoreboard</button>
        <a href="{{ url_for('leaderboard') }}" class="btn-link">View More</a>
      </div>

      <!-- Exercise Log Column -->
      <div class="column">

         <!-- very ugly 'add exercise' form-->
         <form action="/add_exercise" method="POST">
  
          <!-- Default Exercise Selection -->
          <label for="default-exercise">Choose an Exercise:</label>
          <select id="default-exercise" name="default_exercise">
            <option value="">-- Select an exercise --</option>
            <option value="Running">Running</option>
            <option value="Jogging">Jogging</option>
            <option value="Walking">Walking</option>
            <option value="Cycling">Cycling</option>
            <option value="Swimming (casual)">Swimming (casual)</option>
            <option value="Swimming (vigorous)">Swimming (vigorous)</option>
            <option value="Yoga">Yoga</option>
            <option value="Pilates">Pilates</option>
            <option value="Weight Lifting">Weight Lifting</option>
            <option value="HIIT">HIIT Workout</option>
            <option value="Aerobics">Aerobics Class</option>
            <option value="Rowing">Rowing Machine</option>
            <option value="Jump Rope">Jump Rope</option>
            <option value="Dancing">Dancing</option>
            <option value="Hiking">Hiking</option>
          </select>
          
          <br><br>
        
          <label for="default-minutes">Minutes:</label>
          <input type="number" id="default-minutes" name="default_minutes" min="1" required>
        
          <button type="submit">Add</button>

          <br><br>
        
              <!-- OR Add Your Own Exercise -->
        <p style="font-weight: bold;">OR Add Your Own Exercise:</p>
        <br>

        <label for="custom-name">Exercise Name:</label>
        <input type="text" id="custom-name" name="custom_name">

        <br><br>

        <label for="custom-minutes">Minutes:</label>
        <input type="number" id="custom-minutes" name="custom_minutes" min="1">

        <br><br>

        <label for="custom-calories"> Estimated Calories Burned (per 30 min):</label>
        <input type="number" id="custom-calories" name="custom_calories" min="0">

        <br><br>

        <button type="submit">Add Exercise</button>

      </form>

      <br> <hr> <br>

        <div class="column-header">
          <h2 onclick="location.href='{{ url_for('exercise_log') }}'" style="cursor:pointer;">Exercise Log</h2>
         <!-- <button class="add-btn" title="Add an Exercise">+</button> -->


<!-- Trigger Button -->
      <button id="openModalBtn" class="add-btn" title="Add an Exercise">+</button>
        <!-- The Modal -->
        <div id="modal" class="modal">
          <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Add Exercise</h2>
            <form>
              <label>Exercise:</label><br />
              <input type="text" placeholder="e.g. Running"><br /><br />
              <label>Duration:</label><br />
              <input type="text" placeholder="e.g. 30 min"><br /><br />
              <label>Calories:</label><br />
              <input type="text" placeholder="e.g. 300"><br /><br />
              <button type="submit">Add</button>
            </form>
          </div>
        </div>

        <!-- End Modal -->

        </div>
        <table>
          <thead>
            <tr>
              <th>Exercise</th>
              <th>Duration</th>
              <th>Calories</th>
            </tr>
          </thead>
          <tbody>
            {% for log in exercise_log%}
            <tr>
              <td>{{ log.exercise.name }}</td>
              <td>{{ log.duration_minutes }} min</td>
              <td>{{ log.calories_burned }}</td>
            </tr>
            {% else %}
            <tr>
              <td colspan="3">No logs yet</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="total-summary">
        <span>Total: {{ user_total_calories_burnt }} cal</span>
        </div>
        <h3>Weekly Calories Burned</h3>
        <canvas id="dashboardExerciseChart" width="400" height="200"></canvas>
        <a href="{{ url_for('exercise_log') }}" class="btn-link">View More</a>
      </div>

      <!-- Calorie Counter Column -->
      <div class="column">
        <div class="column-header">
          <h2 onclick="location.href='{{ url_for('calorie_counter') }}'" style="cursor:pointer;">Calorie Counter</h2>
         <!-- <button class="add-btn" title="Add a Meal">+</button> -->
      <!-- Trigger Button -->
      <button id="openMealModalBtn" class="add-btn" title="Add a Meal">+</button>

      <!-- The Modal -->
      <div id="mealModal" class="modal">
        <div class="modal-content">
          <span class="close-btn" id="closeMealModal">&times;</span>
          <h2>Add Meal</h2>
          <form>
            <label>Meal:</label><br />
            <input type="text" placeholder="e.g. Snack"><br /><br />
            <label>Calories:</label><br />
            <input type="text" placeholder="e.g. 300"><br /><br />
            <button type="submit">Add</button>
          </form>
        </div>
      </div>

        </div>
        <table>
          <thead>
            <tr>
              <th>Meal</th>
              <th>Calories</th>
            </tr>
          </thead>
          <tbody>
              {% for log in meal_logs%}
              <tr>
                <td>{{ log.date }}</td>
                <td>{{ log.meal.name }}</td>
                <td>{{ log.meal.calories }}</td>
              </tr>
              {% else %}
              <tr>
                <td colspan="3">No logs yet</td>
              </tr>
              {% endfor %}
          </tbody>
        </table>
        <div class="total-summary"><span>Total: 1,650</span></div>
        <h3>Weekly Calorie Intake</h3>
        <canvas id="dashboardCalorieChart" width="400" height="200"></canvas>
        <a href="{{ url_for('calorie_counter') }}" class="btn-link">View More</a>
      </div>

    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const chartData = {{ chart_data | tojson }};

    const ctxDashboardExercise = document.getElementById('dashboardExerciseChart').getContext('2d');

    new Chart(ctxDashboardExercise, {
      type: 'bar',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Calories Burned',
          data: chartData,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });
</script>

<script>
    // Dashboard Calorie Counter Chart
    const ctxDashboardCalorie = document.getElementById('dashboardCalorieChart').getContext('2d');
    new Chart(ctxDashboardCalorie, {
      type: 'line',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Calorie Intake',
          data: [2100, 2000, 2200, 2300, 2100, 1900, 2000],
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          fill: true,
          tension: 0.1,
          borderWidth: 1
        }]
      },
      options: { scales: { y: { beginAtZero: true } } }
    });
  </script>

  <footer>&copy; 2025 FitTrack. All rights reserved.</footer>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
